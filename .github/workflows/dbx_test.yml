name: dbx_workflow

run-name: DBX-TEST

on:
#  pull_request:
#    branches: [ "main", "dev" ]

  workflow_dispatch:
      inputs:
        test:
          type: string
          required: false
          default: ""

jobs:
    my_job:
        runs-on: ubuntu-latest
        steps:
          - name: Upload ENSEMBLE File to DBX
            uses: databricks/upload-dbfs-temp@v0
            id: upload_ensemble
            with:
              local-path: "./files/ENSEMBLE.json"
              databricks-host: "https://enverus-pr-ue1-dev.cloud.databricks.com"
              databricks-token: ${{ env.DBX_TOKEN }}

          - name: Run Notebook
            uses: databricks/run-notebook@v0
            with:
              local-notebook-path: "./templates/ntb_test.py"
              databricks-host: "https://enverus-pr-ue1-dev.cloud.databricks.com"
              databricks-token: ${{ env.DBX_TOKEN }}
              existing-cluster-id: "0123-123947-f9w7986"
              notebook-params-json: >
                [
                  {
                    "key": "ensemble_file_path",
                    "value": "${{ steps.upload_ensemble.outputs.dbfs-file-path }}"
                  }
                ]